---
import ProjectCard from "@/components/work/ProjectCard.astro"
import texts from "@/content/texts"
import Layout from "@/layouts/Layout.astro"
import { getCollection, type CollectionEntry } from "astro:content"

type Work = CollectionEntry<"work">

const projects = (await getCollection("work")).sort(
  (a: Work, b: Work) => b.data.duration.start.valueOf() - a.data.duration.start.valueOf()
)

const columns3: Work[][] = [[], [], []]
const columns2: Work[][] = [[], []]

projects.forEach((project: Work, index: number) => {
  columns3[index % 3].push(project)
  columns2[index % 2].push(project)
})
---

<Layout title={texts.work.title} description={texts.work.description}>
  <main class="min-h-[calc(90vh)] pt-32">
    <!-- 3 columns for lg -->
    <div class="hidden gap-4 px-8 lg:grid lg:grid-cols-3">
      {
        columns3.map((column) => (
          <div class="flex flex-shrink-0 flex-col gap-6">
            {column.map((project) => (
              <ProjectCard project={project} />
            ))}
          </div>
        ))
      }
    </div>

    <!-- 2 columns for sm -->
    <div class="hidden gap-4 px-8 sm:grid sm:grid-cols-2 lg:hidden">
      {
        columns2.map((column) => (
          <div class="flex flex-shrink-0 flex-col gap-6">
            {column.map((project) => (
              <ProjectCard project={project} />
            ))}
          </div>
        ))
      }
    </div>

    <!-- Mobile fallback (1 column) -->
    <div class="flex flex-col gap-12 sm:hidden">
      {projects.map((project, i) => <ProjectCard project={project} />)}
    </div>
  </main>
</Layout>
